(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0c86c2"],{"558d":function(e,t,i){"use strict";i.r(t);i("7f7f"),i("20d6");var s=!1,o={name:"audios",data:function(){return{dialogVisible:!1,formLabelWidth:"100px",show:!1,keywords:"",form:{},fileListCover:[],fileListUrl:[],fileListLrc:[],options:{size:"mini",highlightCurrentRow:!1},pagination:{currentPage:1,pageSize:5,total:0,background:!0,pageSizes:[5,10,15,20],layout:"sizes, prev, pager, next,jumper,->,total, slot"},rules:{songname:[{required:!0,message:"请输入歌曲名称",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],singer:[{required:!0,message:"请输入歌手名称",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],des:[{required:!0,message:"请输入歌曲描述",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],songtime:[{required:!0,message:"请输入歌曲时长",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],cover:[{required:!0,message:"请上传歌曲封面"}],url:[{required:!0,message:"请输入歌曲链接"}],lrc:[{required:!0,message:"请上传歌词"}]},data:[],columns:[{title:"歌名",key:"songname"},{title:"歌手",key:"singer",width:120},{title:"歌曲简介",key:"des",align:"center"},{title:"时长",key:"songtime",width:60}],rowHandle:{columnHeader:"↓",align:"right",custom:[{text:"加入歌单",type:"default",size:"mini",show:!0,icon:"fa fa-play-circle",emit:"custom-emit-3"},{text:"编辑",type:"default",size:"mini",show:s,icon:"fa fa-pencil-square-o",emit:"custom-emit-1"},{text:"删除",type:"default",size:"mini",show:s,icon:"fa fa-trash",emit:"custom-emit-2"}]},opt:""}},beforeCreate:function(){s=this.$store.state.d2admin.user.info.username||!1},mounted:function(){this.refresh()},computed:{username:function(){return this.$store.state.d2admin.user.info.username},token:function(){return this.$store.state.d2admin.user.info.token},songlist:function(){return this.$store.state.d2admin.user.songlist},aplayer:function(){return this.$parent.$refs.aplayer}},methods:{joinSongList:function(e){e.index;var t=e.row,i=this.songlist.findIndex(function(e){return e.id===t.id});-1<i?this.aplayer.switch(i):(this.songlist.push({id:t.id,name:t.songname,artist:t.singer,url:t.url,cover:t.cover,lrc:t.lrc}),this.aplayer.switch(this.songlist.length-1),this.aplayer.play())},add:function(){this.opt="add",this.dialogVisible=!0},update:function(e){this.opt="update",this.form=e,this.dialogVisible=!0},refresh:function(){this.page=1,this.getList()},saveGoodsInfo:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;"add"===t.opt&&t.$http.post("/pc/addsongs",t.form).then(function(e){t.$message.success("发布歌曲成功"),t.dialogVisible=!1,t.refresh()}),"update"===t.opt&&t.$http.post("/pc/updatesongs",t.form).then(function(e){t.$message.success("修改商品成功"),t.dialogVisible=!1})})},handleCustomEvent:function(e,t){var i=this,s=e.index,o=e.row;1===t&&(this.opt="update",this.form=o,this.dialogVisible=!0),2===t&&this.$http.post("/pc/deletesongs",o).then(function(e){i.data.splice(s,1),i.pagination.total--,i.$message.success("删除商品成功")})},getList:function(){var t=this;this.$http.get("/pc/readsongs",{params:{keywords:this.keywords,page:this.pagination.currentPage,pageSize:this.pagination.pageSize}}).then(function(e){t.data=e.data,t.pagination.total=e.count})},handleSizeChange:function(e){this.pagination.currentPage=1,this.pagination.pageSize=e,this.getList()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.getList()},handleSuccessCover:function(e,t,i){this.form.cover=e.result.src},handleSuccessUrl:function(e,t,i){this.form.url=e.result.src},handleSuccessLrc:function(e,t,i){this.form.lrc=e.result.src},handleExceed:function(e,t){this.$message.warning("只能上传一个商品图片")},handleRemoveCover:function(){this.form.cover=""},handleRemoveUrl:function(){this.form.url=""},handleRemoveLrc:function(){this.form.lrc=""},beforeRemove:function(e,t){return this.$confirm("确定移除 ".concat(e.name,"？"))},handleClose:function(){this.form={},this.fileListCover=[],this.fileListUrl=[],this.fileListLrc=[],this.dialogVisible=!1}}},r=i("2877"),a=function(e){e.options.__source="src/views/demo/page2/index.vue"},n=Object(r.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("d2-container",{attrs:{type:"ghost"}},[i("template",{slot:"header"},[i("el-input",{staticClass:"d2-mr",staticStyle:{width:"200px"},attrs:{clearable:"","prefix-icon":"el-icon-search",size:"mini",placeholder:"请输入歌曲或者歌手名称"},on:{change:function(e){return t.refresh("refresh")}},model:{value:t.keywords,callback:function(e){t.keywords="string"==typeof e?e.trim():e},expression:"keywords"}}),t.username?i("el-button",{staticClass:"d2-ml",attrs:{size:"mini"},on:{click:t.add}},[t._v("发布歌曲")]):t._e(),i("el-button",{attrs:{size:"mini"},on:{click:t.refresh}},[t._v("搜索")]),i("div",{staticClass:"tip tip_ab"},[t._v("发布商品信息请联系站长")])],1),i("d2-crud",{ref:"d2Crud",attrs:{columns:t.columns,data:t.data,options:t.options,rowHandle:t.rowHandle,pagination:t.pagination},on:{"pagination-size-change":t.handleSizeChange,"pagination-current-change":t.handleCurrentChange,"custom-emit-3":t.joinSongList,"custom-emit-1":function(e){return t.handleCustomEvent(e,1)},"custom-emit-2":function(e){return t.handleCustomEvent(e,2)}}}),i("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,size:"mini"}},[i("el-form-item",{attrs:{prop:"songname",label:"歌曲名称","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off",placeholder:"请输入歌曲名称"},model:{value:t.form.songname,callback:function(e){t.$set(t.form,"songname","string"==typeof e?e.trim():e)},expression:"form.songname"}})],1),i("el-form-item",{attrs:{prop:"singer",label:"歌手","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off",placeholder:"请输入歌手名称"},model:{value:t.form.singer,callback:function(e){t.$set(t.form,"singer","string"==typeof e?e.trim():e)},expression:"form.singer"}})],1),i("el-form-item",{attrs:{prop:"des",label:"描述","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off",placeholder:"请输入描述该商品的一些信息"},model:{value:t.form.des,callback:function(e){t.$set(t.form,"des","string"==typeof e?e.trim():e)},expression:"form.des"}})],1),i("el-form-item",{attrs:{prop:"songtime",label:"时长","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off",placeholder:"请输入发布者的手机号"},model:{value:t.form.songtime,callback:function(e){t.$set(t.form,"songtime","string"==typeof e?e.trim():e)},expression:"form.songtime"}})],1),i("el-form-item",{attrs:{label:"封面图片","label-width":t.formLabelWidth}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:t.$http.defaults.baseURL+"/pc/uploadimage","on-remove":t.handleRemoveCover,"before-remove":t.beforeRemove,name:"file",accept:".jpg,.png,.jpeg",headers:{Authorization:"Bearer "+t.token},limit:1,"list-type":"picture","on-exceed":t.handleExceed,"on-success":t.handleSuccessCover,"file-list":t.fileListCover}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1),i("el-form-item",{attrs:{label:"歌曲路径","label-width":t.formLabelWidth}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:t.$http.defaults.baseURL+"/pc/uploadaudio","on-remove":t.handleRemoveUrl,"before-remove":t.beforeRemove,name:"file",accept:".mp3",headers:{Authorization:"Bearer "+t.token},limit:1,"list-type":"text","on-exceed":t.handleExceed,"on-success":t.handleSuccessUrl,"file-list":t.fileListUrl}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1),i("el-form-item",{attrs:{label:"歌词路径","label-width":t.formLabelWidth}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:t.$http.defaults.baseURL+"/pc/uploadlrc","on-remove":t.handleRemoveLrc,"before-remove":t.beforeRemove,name:"file",accept:".lrc",headers:{Authorization:"Bearer "+t.token},limit:1,"list-type":"text","on-exceed":t.handleExceed,"on-success":t.handleSuccessLrc,"file-list":t.fileListLrc}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.saveGoodsInfo}},[t._v("确 定")])],1)],1)],2)},[],!1,null,null,null);"function"==typeof a&&a(n);t.default=n.exports}}]);